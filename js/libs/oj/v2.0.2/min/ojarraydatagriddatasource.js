/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojdatasource-common"],function(a){a.Zf=function(a,b,d,c,e){this.Qi=a;this.vr=b;this.hl=d;this.ur=c;this.Rj=e};o_("ArrayCellSet",a.Zf,a);a.Zf.prototype.getData=function(a){return this.Rj.Gda(a.row,a.column)};a.b.g("ArrayCellSet.prototype.getData",{getData:a.Zf.prototype.getData});a.Zf.prototype.getMetadata=function(a){return this.Rj.Hda(a.row,a.column)};a.b.g("ArrayCellSet.prototype.getMetadata",{getMetadata:a.Zf.prototype.getMetadata});a.Zf.prototype.ta=function(a){return"row"==
a?this.Qi:"column"==a?this.hl:-1};a.b.g("ArrayCellSet.prototype.getStart",{ta:a.Zf.prototype.ta});a.Zf.prototype.R=function(a){return"row"===a?Math.max(0,this.vr-this.Qi):"column"===a?Math.max(0,this.ur-this.hl):0};a.b.g("ArrayCellSet.prototype.getCount",{R:a.Zf.prototype.R});a.Zf.prototype.getStartRow=function(){return this.Qi};a.b.g("ArrayCellSet.prototype.getStartRow",{getStartRow:a.Zf.prototype.getStartRow});a.Zf.prototype.getStartColumn=function(){return this.hl};a.b.g("ArrayCellSet.prototype.getStartColumn",
{getStartColumn:a.Zf.prototype.getStartColumn});a.Sa=function(f,b){if(!(f instanceof Array)&&"function"!=typeof f&&"function"!=typeof f.Rqa)throw Error("_ERR_DATA_INVALID_TYPE_SUMMARY\n_ERR_DATA_INVALID_TYPE_DETAIL");this.Hr=this.Sea(b);null!=b&&(this.columns=b.columns,this.Gi=b.initialSort);a.Sa.r.constructor.call(this,f)};o_("ArrayDataGridDataSource",a.Sa,a);a.b.ga(a.Sa,a.bn,"oj.ArrayDataGridDataSource");a.Sa.prototype.Init=function(){null==this.columns&&(this.columns=this.Oda(this.Nj()));this.lha();
"function"==typeof this.data&&this.data.subscribe(this.hma.bind(this),null,"arrayChange");a.Sa.r.Init.call(this)};a.b.g("ArrayDataGridDataSource.prototype.Init",{Init:a.Sa.prototype.Init});a.Sa.prototype.Sea=function(a){if(null!=a&&null!=a.rowHeader)if(a=a.rowHeader,"object"===typeof a){if(null!=a["default"]&&"none"==a["default"])return}else if(null!=a)return a;return"m_defaultIndex"};a.Sa.prototype.lha=function(){var a;a=this.Nj();for(this.rr=0;this.rr<a.length;this.rr+=1)a[this.rr].ojKey=this.rr.toString()};
a.Sa.prototype.Oda=function(a){var b,d;if("number"!==typeof a.length||0===a.length)return[];d=[];for(b in a[0])a[0].hasOwnProperty(b)&&(void 0!=this.Hr&&b==this.Hr||d.push(b));return d};a.Sa.prototype.R=function(a){return"row"===a?this.yo():"column"===a?this.columns.length:0};a.b.g("ArrayDataGridDataSource.prototype.getCount",{R:a.Sa.prototype.R});a.Sa.prototype.yg=function(){return"exact"};a.b.g("ArrayDataGridDataSource.prototype.getCountPrecision",{yg:a.Sa.prototype.yg});a.Sa.prototype.cJ=function(a,
b){var d;if("row"===a){if(void 0==this.Hr)return null;if("m_defaultIndex"==this.Hr)return this.ZB(b);d=this.Nj();return d[b][this.Hr]}if("column"===a)return this.columns[b]};a.Sa.prototype.jea=function(a,b){var d;if("row"===a)return{key:this.ZB(b)};if("column"===a)return d=this.cJ(a,b),null!=this.Gi&&this.Gi.key===d?{key:this.cJ(a,b),sortDirection:this.Gi.direction}:{key:d}};a.Sa.prototype.Of=function(f,b,d){var c,e,g,h;c=f.axis;e=f.start;g=f.count;e=Math.max(0,e);"column"===c?g=Math.min(this.columns.length,
e+g):(h=this.Nj(),g=void 0===this.Hr?e:Math.min(h.length,e+g));c=new a.Gd(e,g,c,this);null!=b&&null!=b.success&&(null==d&&(d={}),b.success.call(d.success,c,f))};a.b.g("ArrayDataGridDataSource.prototype.fetchHeaders",{Of:a.Sa.prototype.Of});a.Sa.prototype.Gda=function(a,b){var d=this.columns[b];return this.Nj()[a][d]};a.Sa.prototype.Hda=function(a,b){return{keys:{row:this.ZB(a),column:this.columns[b]}}};a.Sa.prototype.xg=function(f,b,d){var c,e,g,h,k,l;for(c=0;c<f.length;c+=1)e=f[c],"row"===e.axis?
(g=e.start,h=Math.min(this.yo(),g+e.count)):"column"===e.axis&&(k=e.start,l=Math.min(this.columns.length,k+e.count));void 0===h||void 0===l?null!=b&&null!=b.error&&(null==d&&(d={}),b.error.call(d.error)):(c=new a.Zf(g,h,k,l,this),null!=b&&null!=b.success&&(null==d&&(d={}),b.success.call(d.success,c,f)))};a.b.g("ArrayDataGridDataSource.prototype.fetchCells",{xg:a.Sa.prototype.xg});a.Sa.prototype.keys=function(a){var b=a.row,d=a.column;return new Promise(function(a){a({row:this.ZB(b),column:this.columns[d]})}.bind(this))};
a.b.g("ArrayDataGridDataSource.prototype.keys",{keys:a.Sa.prototype.keys});a.Sa.prototype.Dg=function(a){var b=a.row,d=a.column;return new Promise(function(a){a({row:this.YB(b),column:this.columns.indexOf(d)})}.bind(this))};a.b.g("ArrayDataGridDataSource.prototype.indexes",{Dg:a.Sa.prototype.Dg});a.Sa.prototype.sort=function(a,b,d){var c=[],e=[],g,h;null!=b&&null==d&&(d={});if(null==a)this.EL(b,d);else if(g=a.axis,h=a.key,a=a.direction,"column"===g)void 0==this.Cr&&(this.Tia=this.Gi,this.Cr=this.data.slice()),
this.Gi={key:h,direction:a},this.Nj().sort(this.pZ(a,h)),null!=b&&null!=b.success&&b.success.call(d.success);else if("row"===g){h=this.YB(h);for(g=0;g<this.columns.length;g+=1)c[g]=this.Nj()[h][this.columns[g]];c.sort(this.pZ(a));for(g=0;g<this.columns.length;g+=1)e[g]=this.columns[c.indexOf(this.Nj()[h][this.columns[g]])];this.W4=this.columns;this.columns=e;null!=b&&null!=b.success&&b.success.call(d.success)}else null!==b&&null!=b.error&&b.error.call(d.error,"Invalid axis value")};a.b.g("ArrayDataGridDataSource.prototype.sort",
{sort:a.Sa.prototype.sort});a.Sa.prototype.EL=function(a,b){null!=this.Cr&&(this.data=this.Cr,this.Gi=this.Tia);null!=this.W4&&(this.columns=this.W4);null!=a&&null!=a.success&&a.success.call(b.success)};a.Sa.prototype.getCapability=function(a){return"sort"===a?"column":"move"===a?"row":null};a.b.g("ArrayDataGridDataSource.prototype.getCapability",{getCapability:a.Sa.prototype.getCapability});a.Sa.prototype.pZ=function(a,b){if("ascending"===a)return function(a,c){var e,f;void 0!=b&&(a instanceof Array?
(a=a[parseInt(b,10)],c=c[parseInt(b,10)]):(a=a[b],c=c[b]));e=isNaN(a);f=isNaN(c);a instanceof Date&&(a=a.toISOString(),e=!0);c instanceof Date&&(c=c.toISOString(),f=!0);return e&&f?a<c?-1:a===c?0:1:e?1:f?-1:a-c};if("descending"===a)return function(a,c){var e,f;void 0!=b&&(a instanceof Array?(a=a[parseInt(b,10)],c=c[parseInt(b,10)]):(a=a[b],c=c[b]));e=isNaN(a);f=isNaN(c);a instanceof Date&&(a=a.toISOString(),e=!0);c instanceof Date&&(c=c.toISOString(),f=!0);return e&&f?a>c?-1:a===c?0:1:e?-1:f?1:c-
a}};a.Sa.prototype.move=function(a,b){var d,c;d=this.YB(a);c=this.data.splice(d,1)[0];this.data instanceof Array&&(d=this.xk("delete",a,null,d,-1,!0),this.handleEvent("change",d));null===b?(this.data.push(c),d=this.data.length-1):(d=this.YB(b),this.data.splice(d,0,c));this.data instanceof Array&&(d=this.xk("insert",a,null,d,-1),this.handleEvent("change",d));null!=this.Cr&&(this.Cr=this.data.slice())};a.b.g("ArrayDataGridDataSource.prototype.move",{move:a.Sa.prototype.move});a.Sa.prototype.rd=function(){return"valid"};
a.b.g("ArrayDataGridDataSource.prototype.moveOK",{rd:a.Sa.prototype.rd});a.Sa.prototype.Nj=function(){return"function"===typeof this.data?this.data():this.data};a.Sa.prototype.YB=function(a){var b,d=this.Nj();for(b=0;b<d.length;b++)if(d[b].ojKey===a)return b;return-1};a.Sa.prototype.ZB=function(a){var b=this.Nj();return b[a]?b[a].ojKey:null};a.Sa.prototype.xk=function(a,b,d,c,e,g){var h={source:this};h.operation=a;h.keys={row:b,column:d};h.indexes={row:c,column:e};h.silent=g;return h};a.Sa.prototype.hma=
function(a){var b,d,c,e=!1;d=!1;var g=[],h=[];for(b=0;b<a.length;b++){c=a[b];if(void 0!==c.moved){d=!0;c=this.xk("refresh",null,null);this.handleEvent("change",c);break}"added"===c.status&&(e=!0)}if(!d){for(b=0;b<a.length;b++)c=a[b],"deleted"===c.status&&(d=c.value,c=c.index,d=d.ojKey,g.push({row:d,column:-1}),h.push({row:c,column:-1}));0<g.length&&(c={source:this,operation:"delete",keys:g,indexes:h,silent:e},this.handleEvent("change",c));for(b=0;b<a.length;b++)c=a[b],"added"===c.status&&(d=c.value,
c=c.index,null==d.ojKey&&(d.ojKey=this.rr.toString(),this.rr++),d=d.ojKey,c=this.xk("insert",d,null,c,-1),this.handleEvent("change",c))}null!=this.Cr&&(this.Cr=this.data.slice())};a.Sa.prototype.yo=function(){return this.Nj().length};a.Sa.prototype.w3=function(){return this.Hr};a.b.g("ArrayDataGridDataSource.prototype.getRowHeaderKey",{w3:a.Sa.prototype.w3});a.Sa.prototype.Oo=function(){return this.columns};a.b.g("ArrayDataGridDataSource.prototype.getColumns",{Oo:a.Sa.prototype.Oo});a.Sa.prototype.getData=
function(){return this.data};a.b.g("ArrayDataGridDataSource.prototype.getData",{getData:a.Sa.prototype.getData});a.Gd=function(a,b,d,c){this.$b=a;this.ve=b;this.v4=d;this.Rj=c};o_("ArrayHeaderSet",a.Gd,a);a.Gd.prototype.getData=function(f,b){if(null==this.Rj)return null;a.l.assert(f<=this.ve&&f>=this.$b,"index out of bounds");a.l.assert(null==b||0==b,"level out of bounds");return this.Rj.cJ(this.v4,f)};a.b.g("ArrayHeaderSet.prototype.getData",{getData:a.Gd.prototype.getData});a.Gd.prototype.getMetadata=
function(f,b){if(null==this.Rj)return null;a.l.assert(f<=this.ve&&f>=this.$b,"index out of bounds");a.l.assert(null==b||0==b,"level out of bounds");return this.Rj.jea(this.v4,f)};a.b.g("ArrayHeaderSet.prototype.getMetadata",{getMetadata:a.Gd.prototype.getMetadata});a.Gd.prototype.Ag=function(){return 0<this.R()?1:0};a.b.g("ArrayHeaderSet.prototype.getLevelCount",{Ag:a.Gd.prototype.Ag});a.Gd.prototype.Vb=function(f,b){a.l.assert(f<=this.ve&&f>=this.$b,"index out of bounds");a.l.assert(null==b||0==
b,"level out of bounds");return{extent:1,more:{before:!1,after:!1}}};a.b.g("ArrayHeaderSet.prototype.getExtent",{Vb:a.Gd.prototype.Vb});a.Gd.prototype.oe=function(f,b){a.l.assert(f<=this.ve&&f>=this.$b,"index out of bounds");a.l.assert(null==b||0==b,"level out of bounds");return 1};a.b.g("ArrayHeaderSet.prototype.getDepth",{oe:a.Gd.prototype.oe});a.Gd.prototype.R=function(){return null==this.Rj?0:Math.max(0,this.ve-this.$b)};a.b.g("ArrayHeaderSet.prototype.getCount",{R:a.Gd.prototype.R});a.Gd.prototype.ta=
function(){return this.$b};a.b.g("ArrayHeaderSet.prototype.getStart",{ta:a.Gd.prototype.ta})});