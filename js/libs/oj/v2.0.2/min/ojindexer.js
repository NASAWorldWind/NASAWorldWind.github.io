/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","hammerjs","promise","ojs/ojjquery-hammer","ojs/ojcomponentcore"],function(a,f,b){a.Ae=function(){};o_("IndexerModel",a.Ae,a);a.Ae.PREFIX_OTHERS="__others__";o_("IndexerModel.PREFIX_OTHERS",a.Ae.PREFIX_OTHERS,a);a.Ae.D={CHANGE:"change"};o_("IndexerModel.EventType",a.Ae.D,a);a.Ae.prototype.setPrefix=function(){};a.b.g("IndexerModel.prototype.setPrefix",{setPrefix:a.Ae.prototype.setPrefix});a.Ae.prototype.getIndexablePrefixes=function(){};a.b.g("IndexerModel.prototype.getIndexablePrefixes",
{getIndexablePrefixes:a.Ae.prototype.getIndexablePrefixes});a.Ae.prototype.getPrefixes=function(){};a.b.g("IndexerModel.prototype.getPrefixes",{getPrefixes:a.Ae.prototype.getPrefixes});a.gg=function(a){this.Qc=a;this.Init()};o_("ListViewIndexerModel",a.gg,a);a.b.ga(a.gg,a.Pg,"oj.ListViewIndexerModel");a.gg.prototype.getIndexablePrefixes=function(){return this.Qc.V.A("indexerCharacters").split("|")};a.b.g("ListViewIndexerModel.prototype.getIndexablePrefixes",{getIndexablePrefixes:a.gg.prototype.getIndexablePrefixes});
a.gg.prototype.getPrefixes=function(){null==this.cN&&(this.cN=this.Eda());return this.cN};a.b.g("ListViewIndexerModel.prototype.getPrefixes",{getPrefixes:a.gg.prototype.getPrefixes});a.gg.prototype.Eda=function(){var a=[],b=this.Qc.Mw();if(null!=b)for(var e=this.getIndexablePrefixes(),g=0;g<e.length;g++){var h=e[g];b.each(function(){if(0==f(this).text().indexOf(h))return a.push(h),!1})}return a};a.gg.prototype.setPrefix=function(b){return b==a.Ae.PREFIX_OTHERS?this.Bla():this.Cla(b)};a.b.g("ListViewIndexerModel.prototype.setPrefix",
{setPrefix:a.gg.prototype.setPrefix});a.gg.prototype.Bla=function(){var b,c=this,e,g,h,k,l;b=this.getIndexablePrefixes();return new Promise(function(m){e=null;g=c.Qc.Mw();null!=g&&g.each(function(){h=f(this).text();for(k=0;k<b.length;k++)if(l=b[k],0==h.indexOf(l))return!0;e=this;return!1});e?(c.Qc.$_(e),m(a.Ae.PREFIX_OTHERS)):m(null)})};a.gg.prototype.Cla=function(a){var b,e,f=this,h=null,k;b=this.getIndexablePrefixes();e=b.indexOf(a);return new Promise(function(l){if(-1==e)l(null);else{for(;e<b.length;){a=
b[e];k=f.rda(a);if(null!=k){f.Qc.$_(k);h=a;break}e++}l(h)}})};a.gg.prototype.rda=function(a){var b,e,g;e=this.Qc.Mw();null!=e&&e.each(function(){g=f(this).text();if(0==g.indexOf(a))return b=this,!1});return b};a.gg.prototype.K2=function(){this.cN=null;this.handleEvent(a.Ae.D.CHANGE,{})};(function(){a.ya("oj.ojIndexer",f.oj.baseComponent,{defaultElement:"\x3cul\x3e",version:"1.2",widgetEventPrefix:"oj",options:{data:null},_ComponentCreate:function(){this._super();this.Ba()},rf:function(){var a;this._super();
this.xU();this.g0();this.Jba();a=this.Wn()[0];this.Bj(a);this.Zja(a)},_destroy:function(){var b,c;this._super();this.Lma();this.element.removeClass("oj-component-initnode");b=this.Wn()[0];this.Ok(b);this.Kma(b);c=this.OB();null!=c&&this.FO&&c.off(a.Ae.D.u6,this.FO);a.v.unwrap(this.element,f(b))},_setOption:function(a,b){this._superApply(arguments);"data"==a&&this.refresh()},widget:function(){return this.Wn()},refresh:function(){this._super();this.element.empty();this.xU();this.g0();this.sr=null},
getNodeBySubId:function(a){var b,e,g,h,k;if(null==a)return this.element?this.element[0]:null;if("oj-indexer-prefix"===a.subId)for(a=a.prefix,b=this.element.children("li"),e=0;e<b.length;e++){h=b.get(e);if(f(h).attr("data-range")==a)return h;k=f(h).attr("data-includes");if(null!=k)for(k=k.split("|"),g=0;g<k.length;g++)if(k[g]==a)return h}return null},getSubIdByNode:function(a){return null!=a&&(a=f(a).attr("data-range"),null!=a)?{subId:"oj-indexer-prefix",prefix:a}:null},g0:function(){this.element.attr("role",
"slider").attr("aria-orientation","vertical").attr("aria-describedby",this.element.prop("id")+":desc").attr("aria-valuemin",0).attr("aria-valuemax",Math.max(0,this.element.children().length-1))},Lma:function(){this.element.removeAttr("role").removeAttr("aria-orientation").removeAttr("aria-describedby").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuetext")},Jba:function(){var b,c;b=a.v.Ud()?"ariaTouchInstructionText":"ariaKeyboardInstructionText";c=f(document.createElement("div"));
c.prop("id",this.element.prop("id")+":desc");c.addClass("oj-helper-hidden-accessible").text(this.A(b));this.Wn().append(c)},Wn:function(){null==this.cz&&(this.cz=this.Hba());return this.cz},Hba:function(){var a=f(document.createElement("div"));a.addClass("oj-indexer oj-component");this.element.parent()[0].replaceChild(a[0],this.element[0]);a.prepend(this.element);return a},xU:function(){var a,b,e,f,h,k,l;a=this.OB();if(null!=a){b=this.element;e=a.getIndexablePrefixes();f=a.getPrefixes();a=this.A("indexerOthers");
h=this.widget().outerHeight();k=this.aB(e[0],f);b.append(k);k=k.outerHeight();h=Math.floor(h/k);this.Wn().removeClass("oj-indexer-abbr");h=Math.floor((e.length+1)/h)+1;1<h&&this.Wn().addClass("oj-indexer-abbr");for(k=1+h;k<e.length;k=k+h+1)1<h?(l=this.cca(e,k-h,k-1),b.append(l)):k--,l=e[k],l=this.aB(l,f),b.append(l);e=this.aB(e[e.length-1],f);b.append(e);e=this.aB(a);e.attr("data-others","true");b.append(e)}},aB:function(a,b){var e=f(document.createElement("li"));e.attr("data-range",a).text(a);null!=
b&&-1==b.indexOf(a)&&e.addClass("oj-disabled");return e},cca:function(a,b,e){var g,h="";g=f(document.createElement("li"));for(g.addClass("oj-indexer-ellipsis").attr("data-range",a[b+Math.round((e-b)/2)]);b<e;b++)h=h+a[b]+"|";h+=a[e];g.attr("data-includes",h);return g},Ba:function(){var b=this,c;this.element.uniqueId().addClass("oj-component-initnode").attr("tabIndex",0);this._on(this.element,{click:function(a){b.rfa(a)},keydown:function(a){b.xq(a)},focus:function(a){b.Qfa(a)},blur:function(a){b.mfa(a)}});
c=this.OB();null!=c&&(this.FO=function(){b.refresh()},c.on(a.Ae.D.u6,this.FO))},rfa:function(a){0===a.button&&(a=f(a.target),this.NL(a))},Qfa:function(){this.Wn().addClass("oj-focus-ancestor");null==this.sr&&this.Ik(this.element.children("li").first())},mfa:function(){this.Wn().removeClass("oj-focus-ancestor")},xq:function(a){var b,e=!1;switch(a.keyCode){case 38:b=this.sr.prev();break;case 40:b=this.sr.next();break;case 13:this.NL(this.sr),e=!0}null!=b&&0<b.length&&(e=!0,this.Ik(b));e&&a.preventDefault()},
Ik:function(a){null!=this.sr&&this.sr.removeClass("oj-focus");a.addClass("oj-focus");this.Oma(a);this.sr=a},OB:function(){var a=this.option("data");if(null!=a&&(void 0==a.setPrefix||void 0==a.getIndexablePrefixes||void 0==a.getPrefixes))throw"Invalid IndexerModel";return a},NL:function(b){var c=b.attr("data-range");b.attr("data-others")&&(c=a.Ae.PREFIX_OTHERS);this.PL(c)},PL:function(a){var b=this,e;this.OB().setPrefix(a).then(function(a){null!=a&&(e=b.qj(a),null!=e&&b.Ik(e))})},Oma:function(b){var c,
e="";c=b.attr("data-includes");null!=c?(c=c.split("|"),0<c.length&&(e=this.A("ariaInBetweenText",{first:c[0],second:c[c.length-1]}))):(c=b.attr("data-range"),e=c===a.Ae.PREFIX_OTHERS?this.A("ariaOthersLabel"):c);b.hasClass("oj-disabled")&&(e=e+". "+this.A("ariaDisabledLabel"));this.element.attr("aria-valuetext",e);this.element.attr("aria-valuenow",b.index())},qj:function(a){var b,e,g,h,k;b=this.element.children();for(e=0;e<b.length;e++)if(g=b.get(e),h=f(g).attr("data-range"),k=f(g).attr("data-includes"),
null!=h&&h==a||null!=k&&-1<k.indexOf(a))return f(g);return null},Ok:function(b){b&&this.Le&&a.v.Si(b,this.Le)},Bj:function(b){b&&(null==this.Le&&(this.Le=this.af.bind(this)),a.v.Ph(b,this.Le))},Kma:function(a){f(a).off("panstart panmove panend")},Zja:function(a){var c=this,e,g,h,k,l,m,n,p,r,s,q,t;e={recognizers:[[b.Pan,{direction:b.DIRECTION_VERTICAL}]]};f(a).jl(e).on("panstart",function(a){g=a.gesture.target;h=c.element[0].getBoundingClientRect().left+5;k=g.getBoundingClientRect().top;c.NL(f(g));
l=g;m=g.getAttribute("data-range");n=k}).on("panmove",function(a){p=n;n=k+a.gesture.deltaY;g=document.elementFromPoint(h,n);null!=g&&(r=n-p,l==g?(s=g.getAttribute("data-includes"),null!=s&&(s=s.split("|"),q=s.indexOf(m),t=null,0<r&&q<s.length-1?t=s[q+1]:0>r&&0<q&&(t=s[q-1]),null!=t&&(m=t,c.PL(t)))):g.hasAttribute("data-range")&&(s=g.getAttribute("data-includes"),t=null,null!=s&&(0<r&&g==l.nextElementSibling?t=s[0]:0>r&&g==l.previousElementSibling&&(t=s[s.length-1])),null==t&&(t=g.getAttribute("data-range")),
l=g,m=t,c.PL(m)))}).on("panend",function(){t=n=m=l=null})},af:function(a,b){0<a&&0<b&&this.refresh()}})})()});