/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojdatasource-common","ojs/ojrowexpander"],function(a){a.$h=function(f,b,d,c,e,g){a.l.vy(g);this.Qi=f;this.vr=b;this.hl=d;this.ur=c;this.Ab=e;this.Vd=g};o_("FlattenedTreeCellSet",a.$h,a);a.$h.prototype.getData=function(f){var b;b=this.TW(f);if(null==b)return null;f=b[0];b=b[1];a.l.assert(f<this.Ab.ta()+this.Ab.R()&&b<this.Vd.length);b=this.Vd[b];f=this.Ab.getData(f);return null!=f?f.get?f.get(b):f[b]:null};a.b.g("FlattenedTreeCellSet.prototype.getData",{getData:a.$h.prototype.getData});
a.$h.prototype.getMetadata=function(f){var b;b=this.TW(f);if(null==b)return null;f=b[0];b=b[1];a.l.assert(f<this.Ab.ta()+this.Ab.R()&&b<this.Vd.length);b=this.Vd[b];f=this.Ab.getMetadata(f);f.keys={row:f.key,column:b};return f};a.b.g("FlattenedTreeCellSet.prototype.getMetadata",{getMetadata:a.$h.prototype.getMetadata});a.$h.prototype.TW=function(f){var b;a.l.Kf(f);if(null==this.Ab||0==this.Ab.length)return null;b=f.row-this.Qi+this.Ab.ta();f=f.column;a.l.nm(b,null);a.l.nm(f,null);a.l.assert(0<=b&&
0<=f);return[b,f]};a.$h.prototype.ta=function(a){return"row"===a?this.Qi:"column"===a?this.hl:0};a.b.g("FlattenedTreeCellSet.prototype.getStart",{ta:a.$h.prototype.ta});a.$h.prototype.R=function(a){return"row"===a?Math.min(this.vr-this.Qi,this.Ab.R()):"column"===a?this.ur-this.hl:0};a.b.g("FlattenedTreeCellSet.prototype.getCount",{R:a.$h.prototype.R});a.bb=function(f,b){a.bb.r.constructor.call(this,f,b)};o_("FlattenedTreeDataGridDataSource",a.bb,a);a.b.ga(a.bb,a.ca,"oj.FlattenedTreeDataGridDataSource");
a.bb.prototype.Init=function(){a.bb.r.Init.call(this);this.Vd=a.bb.r.Jy.call(this,"columns");this.Gg=a.bb.r.Jy.call(this,"rowHeader")};a.b.g("FlattenedTreeDataGridDataSource.prototype.Init",{Init:a.bb.prototype.Init});a.bb.prototype.yg=function(a){return"row"===a?"estimate":"actual"};a.b.g("FlattenedTreeDataGridDataSource.prototype.getCountPrecision",{yg:a.bb.prototype.yg});a.bb.prototype.R=function(a){return"row"===a?-1:"column"===a?this.Vd.length:0};a.b.g("FlattenedTreeDataGridDataSource.prototype.getCount",
{R:a.bb.prototype.R});a.bb.prototype.Of=function(f,b,d){var c,e;c=f.axis;if("column"===c)c=f.start+f.count,c>this.R("column")&&(c=this.R("column")-f.start),e=new a.kf(f.start,c,this.Vd);else if("row"===c){if(null!=this.Gg){this.fl={range:f,callbacks:b,callbackObjects:d};return}e=new a.Gd(f.start,f.start,c,null)}null!=e&&null!=b&&null!=b.success&&(null==d&&(d={}),b.success.call(d.success,e,f))};a.b.g("FlattenedTreeDataGridDataSource.prototype.fetchHeaders",{Of:a.bb.prototype.Of});a.bb.prototype.xg=
function(f,b,d){var c,e,g,h;for(c=0;c<f.length;c++)if(e=f[c],"row"==e.axis){g=e.start;h=e.count;break}a.bb.r.No.call(this,{start:g,count:h},{success:function(a){this.SJ(a,f,b,d,0)}.bind(this),error:function(a){this.Pfa(a,{start:g,count:h},b,d)}.bind(this)})};a.b.g("FlattenedTreeDataGridDataSource.prototype.fetchCells",{xg:a.bb.prototype.xg});a.bb.prototype.keys=function(f){var b,d;b=f.row;d=f.column;return new Promise(function(c){b>a.bb.r.Hoa.call(this).end||d>this.Vd.length?c(null):c({row:a.bb.r.getKey.call(this,
b),column:this.Vd[d]})}.bind(this))};a.b.g("FlattenedTreeDataGridDataSource.prototype.keys",{keys:a.bb.prototype.keys});a.bb.prototype.Dg=function(f){var b,d,c,e,g;c=f.row;e=f.column;return new Promise(function(f){b=a.bb.r.Mi.call(this,c);for(g=0;g<this.Vd.length;g++)if(this.Vd[g]===e){d=g;break}0<=b||0<=d?f({row:b,column:d}):f(null)}.bind(this))};a.b.g("FlattenedTreeDataGridDataSource.prototype.indexes",{Dg:a.bb.prototype.Dg});a.bb.prototype.sort=function(f,b,d){return a.bb.r.getWrappedDataSource.call(this).sort(f,
{success:function(){this.vga(b,d)}.bind(this),error:b.error})};a.b.g("FlattenedTreeDataGridDataSource.prototype.sort",{sort:a.bb.prototype.sort});a.bb.prototype.vga=function(a,b){this.refresh();a.success&&(null==b&&(b={}),a.success.call(b.success))};a.bb.prototype.move=function(f,b,d,c){a.bb.r.getWrappedDataSource.call(this).move(f,b,d,c)};a.b.g("FlattenedTreeDataGridDataSource.prototype.move",{move:a.bb.prototype.move});a.bb.prototype.getCapability=function(f){return"default"===a.bb.r.getWrappedDataSource.call(this).getCapability(f)?
"column":"none"};a.b.g("FlattenedTreeDataGridDataSource.prototype.getCapability",{getCapability:a.bb.prototype.getCapability});a.bb.prototype.Qy=function(f,b){a.bb.r.Qy.call(this,f,b)};a.bb.prototype.SJ=function(f,b,d,c){var e,g,h,k,l,m;for(e=0;e<b.length;e++)g=b[e],"row"==g.axis?(h=g.start,k=g.count):"column"==g.axis&&(l=g.start,m=g.count,l+m>this.R("column")&&(m=this.R("column")-l));this.fl&&(e=this.fl.range,e.start==h&&e.count==k&&this.YJ(f,e,this.fl.callbacks,this.fl.callbackObjects),this.fl=
null);f=new a.$h(h,h+k,l,l+m,f,this.Vd);d.success&&(null==c&&(c={}),d.success.call(c.success,f,b))};a.bb.prototype.Pfa=function(a,b,d,c){var e;this.fl&&(e=this.fl.range,e.start==b.start&&e.count==b.count&&(b=this.fl.callbacks,e=this.fl.callbackObjects,b.error&&(null==e&&(e={}),b.error.call(e.error,a))),this.fl=null);d.error&&(null==c&&(c={}),d.success.call(c.error,a))};a.bb.prototype.YJ=function(f,b,d,c){f=new a.kf(b.start,b.start+b.count,this.Vd,f,this.Gg);d.success&&(null==c&&(c={}),d.success.call(c.success,
f,b))};a.bb.prototype.rE=function(f,b,d){var c,e,g,h;c=null;this.Gg&&(c=new a.kf(f,f+d.R(),this.Vd,d,this.Gg));b=new a.$h(f,f+d.R(),0,this.Vd.length,d,this.Vd);g=[];h=[];for(e=0;e<d.R();e++)g.push({row:this.ah(f+e).key}),h.push({row:f+e,column:-1});f={source:this,operation:"insert"};f.result=b;c&&(f.header=c);f.keys=g;f.indexes=h;a.bb.r.handleEvent.call(this,"change",f)};a.bb.prototype.QE=function(f){var b,d,c;b=[];c=[];for(d=0;d<f.length;d++)b.push({row:f[d].key}),c.push({row:f[d].index,column:-1});
f={source:this,operation:"delete"};f.keys=b;f.indexes=c;a.bb.r.handleEvent.call(this,"change",f)};a.bb.prototype.ZN=function(f,b){b.success.call(null,new a.Te(null,f.start))};a.kf=function(f,b,d,c,e){a.l.vy(d);this.$b=f;this.ve=b;this.zE=d;this.Ab=c;this.Gg=e};o_("FlattenedTreeHeaderSet",a.kf,a);a.kf.prototype.getData=function(f,b){var d;a.l.assert(f<=this.ve&&f>=this.$b,"index out of bounds");a.l.assert(null==b||0==b,"level out of bounds");return null!=this.Gg&&null!=this.Ab?(d=this.Ab.getData(f-
this.$b+this.Ab.ta()),null!=d?d.get?d.get(this.Gg):d[this.Gg]:null):this.zE[f]};a.b.g("FlattenedTreeHeaderSet.prototype.getData",{getData:a.kf.prototype.getData});a.kf.prototype.getMetadata=function(f,b){a.l.assert(f<=this.ve&&f>=this.$b,"index out of bounds");a.l.assert(null==b||0==b,"level out of bounds");return null!=this.Gg&&null!=this.Ab?this.Ab.getMetadata(f-this.$b+this.Ab.ta()):{key:this.getData(f)}};a.b.g("FlattenedTreeHeaderSet.prototype.getMetadata",{getMetadata:a.kf.prototype.getMetadata});
a.kf.prototype.R=function(){return null!=this.Gg&&null!=this.Ab?Math.min(this.Ab.R(),this.ve-this.$b):Math.max(0,this.ve-this.$b)};a.b.g("FlattenedTreeHeaderSet.prototype.getCount",{R:a.kf.prototype.R});a.kf.prototype.Ag=function(){return 0<this.R()?1:0};a.b.g("FlattenedTreeHeaderSet.prototype.getLevelCount",{Ag:a.kf.prototype.Ag});a.kf.prototype.Vb=function(f,b){a.l.assert(f<=this.ve&&f>=this.$b,"index out of bounds");a.l.assert(null==b||0==b,"level out of bounds");return{extent:1,more:{before:!1,
after:!1}}};a.b.g("FlattenedTreeHeaderSet.prototype.getExtent",{Vb:a.kf.prototype.Vb});a.kf.prototype.oe=function(f,b){a.l.assert(f<=this.ve&&f>=this.$b,"index out of bounds");a.l.assert(null==b||0==b,"level out of bounds");return 1};a.b.g("FlattenedTreeHeaderSet.prototype.getDepth",{oe:a.kf.prototype.oe})});