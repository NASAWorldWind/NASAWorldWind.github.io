/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojpopupcore"],function(a,f){(function(){var b="oj-left oj-center oj-right oj-top oj-middle oj-bottom".split(" "),d={"right-top":"oj-right oj-top","right-middle":"oj-right oj-middle","right-bottom":"oj-right oj-bottom","left-top":"oj-left oj-top","left-middle":"oj-left oj-middle","left-bottom":"oj-left oj-bottom","center-top":"oj-center oj-top","center-middle":"oj-center oj-bottom","center-bottom":"oj-center oj-bottom"};a.ya("oj.ojPopup",f.oj.baseComponent,
{widgetEventPrefix:"oj",options:{autoDismiss:"focusLoss",chrome:"default",initialFocus:"auto",position:{my:"start top",at:"start bottom",of:"",collision:"flip"},tail:"none",modality:"modeless",role:"tooltip",beforeOpen:null,open:null,beforeClose:null,close:null,focus:null},_ComponentCreate:function(){this._super();var a=f("\x3cdiv\x3e");this.me=a.hide().addClass("oj-popup").attr("aria-hidden","true");a.addClass("oj-component");var b=f("\x3cdiv\x3e").addClass("oj-popup-content");b.attr("role","presentation");
b.appendTo(a);this.element.after(a);this.element.appendTo(b);this.element.show();this.IU();this.h0();this.py=f.proxy(this.qy,this)},_destroy:function(){this.isOpen()&&this.aq();this.eV();delete this.py;delete this.Aj;a.v.unwrap(this.element,this.me);this.element.hide();var b=this.Kn;isNaN(b)||(delete this.Kn,window.clearTimeout(b));this.fV();this._super()},widget:function(){return this.me},open:function(b,d){if(this.isOpen()&&(this.close(),this.isOpen()))return;this.xla(b);var f=this.me;b=this.kc;
a.Ea.Ni(f.attr("id"))&&f.attr("id",this.$B("wrapper"));if(!1!==this._trigger("beforeOpen")){this.v0(d);var h=this.options;this.KL(h.autoDismiss);this.z$();f.attr("role",h.role);d=h.position;var k="rtl"===this.dc();d=a.oc.Hg(d,k);var k="oj-popup-layer",l=h.tail;"none"!==l&&(k+=" "+["oj-popup-tail",l].join("-"));l={};l[a.N.Ra.lf]=f;l[a.N.Ra.mv]=b;l[a.N.Ra.qv]=d;l[a.N.Ra.qp]=this.ut();l[a.N.Ra.gn]=k;l[a.N.Ra.bi]=h.modality;a.N.re().open(l);this._trigger("open");this.tK();this.gha();this._on(f,{keydown:this.Ot,
keyup:this.Ot});b&&0<b.length&&this._on(b,{keydown:this.Ot,keyup:this.Ot})}},close:function(){if(this.isOpen()&&(!1!==this._trigger("beforeClose")||this.bx)){this.Qka();var b=this.kc,d=this.me;this._off(d,"keydown keyup");b&&0<b.length&&this._off(b,"keydown keyup");this.fV();b={};b[a.N.Ra.lf]=d;a.N.re().close(b);this.gka();this.KL();delete this.kc;d=this.options.position;d._ofo&&(delete d._ofo,delete d.of);this._trigger("close")}},isOpen:function(){return this.me.is(":visible")},refresh:function(){this._super();
this.isOpen()&&this.I_();var b=this.me;a.N.re().tP(b,a.N.Bc.jn)},_setOption:function(b,d){var f=this.options;switch(b){case "tail":d!==f.tail&&this.Jla(d);break;case "chrome":d!==f.chrome&&this.h0(d);break;case "position":this.v0(d);this.refresh();return;case "autoDismiss":this.isOpen()&&d!==f.autoDismiss&&this.KL(d);break;case "modality":this.isOpen()&&(f={},f[a.N.Ra.lf]=this.me,f[a.N.Ra.bi]=d,a.N.re().yu(f))}this._superApply(arguments)},csa:function(){return"oj-popup"},Jla:function(a){this.eV();
this.IU(a);this.I_()},IU:function(b){b=b?b:this.options.tail;if("none"!==b){b=["oj-popup-tail",b].join("-");var d=f("\x3cdiv\x3e").hide();d.addClass("oj-popup-tail").addClass(b);d.attr("role","presentation");this.k1=d.attr("id",this.$B("tail")).attr("id");var g=this.me;d.appendTo(g);g.addClass(b);this.isOpen()&&(d={},d[a.N.Ra.lf]=g,d[a.N.Ra.gn]="oj-popup-layer "+b,a.N.re().yu(d))}},iX:function(){var a=this.k1;return a?f(document.getElementById(a)):null},eV:function(){var b=this.iX();b&&b.remove();
delete this.k1;b=this.me;b.removeClass(["oj-popup-tail",this.options.tail].join("-"));if(this.isOpen()){var d={};d[a.N.Ra.lf]=b;d[a.N.Ra.gn]="oj-popup-layer";a.N.re().yu(d)}},h0:function(a){a=a?a:this.options.chrome;var b=this.me;"default"===a&&b.hasClass("oj-popup-no-chrome")?b.removeClass("oj-popup-no-chrome"):"none"!==a||b.hasClass("oj-popup-no-chrome")||b.addClass("oj-popup-no-chrome")},xla:function(b){b?"string"===f.type(b)?b=f(b):1===b.nodeType&&(b=f(b)):b=f(document.activeElement);if(b instanceof
jQuery&&1<b.length)for(var d=this.me,g=0;g<b.length;g++){var h=b[0];if(!a.v.To(d[0],h)){b=f(h);break}}else if(!(b instanceof jQuery)||b instanceof jQuery&&0===b.length)b=f(document.activeElement);this.kc=b},v0:function(a){var b=this.options;a&&(b.position=f.extend(b[a],a));a=b.position;b=this.py;f.isFunction(a.using)&&a.using!==b&&(a.origUsing=a.using);a.using=b;b=this.kc;a.of||(a.of=b,a._ofo=!0)},qy:function(c,e){var g=e.element.element;if(c.top!==g.css("top")||c.left!==g.css("left")){var h=this.iX();
if(h){h.hide();for(var k=0;k<b.length;k++)h.removeClass(b[k]),g.removeClass(b[k]);h.removeAttr("style");if(e.target&&0===e.target.height&&0===e.target.width&&(k="rtl"===this.dc(),k=a.oc.Hg(this.options.position,k).my,!a.Ea.Ni(k))){var k=k.split(" "),l=k[0],m="middle";1<k.length&&(m="center"===k[1]?"middle":k[1]);e.horizontal=l;e.vertical=m}k=d[[e.horizontal,e.vertical].join("-")];h.addClass(k);g.addClass(k);h.show();"left"===e.horizontal?(k=h.outerWidth(),k-=k+a.v.wm(h.css("left")),c.left+=k-2):"right"===
e.horizontal&&(k=h.outerWidth(),k-=k+a.v.wm(h.css("right")),c.left-=k-2);"top"===e.vertical?(k=h.outerHeight(),k-=k+a.v.wm(h.css(e.vertical)),c.top+=k-2):"bottom"===e.vertical&&(k=h.outerHeight(),k-=k+a.v.wm(h.css(e.vertical)),c.top-=k-2);g.css(c);"center"===e.horizontal?(g=g.width(),g=Math.round((g/2-h.outerWidth()/2)/g*100),h.css({left:g+"%"})):"middle"===e.vertical&&(g=g.height(),g=Math.round((g/2-h.outerHeight()/2)/g*100),h.css({top:g+"%"}))}else g.css(c);h=this.options;(g=h.position.origUsing)&&
g(c,e);"focusLoss"===h.autoDismiss&&a.oc.fO(e)&&(this.lK=!0,this.Kn=this._delay(f.proxy(this.aq,this),1))}},I_:function(){var b=this.me,d=this.options.position,f="rtl"===this.dc();b.position(a.oc.Hg(d,f))},tK:function(a){var b=this.uca();a&&"none"===b&&(b="popup");"firstFocusable"===b&&(a=this.element.find(":focusable"),0<a.length?(f(a[0]).focus(),this._trigger("focus")):b="popup");"popup"===b&&(b=this.me,b.attr("tabindex","-1"),b.focus(),this._trigger("focus"))},uca:function(){var b=this.options,
d=b.initialFocus;"auto"===d&&(d="modal"===b.modality?a.v.Ud()?"popup":"firstFocusable":"none");return d},tC:function(b,d){b||(b=document.activeElement);if(!b)return!1;var f=this.me;d&&(f=f.parent());return a.v.To(f[0],b)},vY:function(b){b||(b=document.activeElement);return a.v.To(this.kc[0],b)},Qka:function(){this.lK?delete this.lK:this.tC(null,!0)&&this.kc.focus()},Ot:function(a){if(!a.isDefaultPrevented()){var b=a.type,d=a.target;if("keyup"===b&&a.keyCode===f.ui.keyCode.ESCAPE&&(this.tC(d)||this.vY(d)))a.preventDefault(),
this.close();else if("keydown"===b&&117===a.keyCode)this.tC(d)?(d=this.options,"modeless"===d.modality?(a.preventDefault(),a=this.kc,a.focus()):this.close()):this.vY(d)&&(a.preventDefault(),this.tK(!0));else if("keydown"===b&&a.keyCode===f.ui.keyCode.TAB&&this.tC(d)){var h=this.element.find(":tabbable");if(0<h.length){var b=h[0],h=h[h.length-1],k=this.me;b!==d&&k[0]!==d||!a.shiftKey?h!==d||a.shiftKey||(a.preventDefault(),h===b?(k.attr("tabindex","-1"),k.focus()):f(b).focus()):(a.preventDefault(),
b===h&&b===d?(k.attr("tabindex","-1"),k.focus()):f(h).focus())}else a.preventDefault(),d=this.options,"modeless"===d.modality?(a=this.kc,a.focus()):this.close()}}},KL:function(b){var d=this.RV,g=this.ut();d&&(delete g[a.N.Bc.as],delete this.RV);"focusLoss"===b&&(d=this.RV=f.proxy(this.yca,this),g[a.N.Bc.as]=d);this.isOpen()&&(b={},b[a.N.Ra.lf]=this.me,b[a.N.Ra.qp]=g,a.N.re().yu(b))},yca:function(b){var d=this.kc,g=this.me.parent(),h=b.target,k=this.zB;if(k&&(k=k.getLink())&&a.v.To(k[0],h))return;
if(!a.v.To(d[0],h)&&!a.v.To(g[0],h)){if(f(h).is(":focusable")){if("mousedown"===b.type||"touchstart"===b.type)return;this.lK=!0}this.close()}},z$:function(){var a=this.kc,b=this.me.attr("id"),d=a.attr("aria-describedby"),d=d?d.split(/\s+/):[];d.push(b);d=f.trim(d.join(" "));a.attr("aria-describedby",d)},gka:function(){var a=this.kc,b=this.me.attr("id"),d=a.attr("aria-describedby"),d=d?d.split(/\s+/):[],b=f.inArray(b,d);-1!==b&&d.splice(b,1);(d=f.trim(d.join(" ")))?a.attr("aria-describedby",d):a.removeAttr("aria-describedby")},
gha:function(){var b=a.Na.Fy().os===a.Na.aj.zF,d=this.GK;d||(d=this.GK=new a.De);var g;g=b?this.A("none"===this.options.initialFocus?"ariaLiveRegionInitialFocusNoneTouch":"ariaLiveRegionInitialFocusFirstFocusableTouch"):this.A("none"===this.options.initialFocus?"ariaLiveRegionInitialFocusNone":"ariaLiveRegionInitialFocusFirstFocusable");d.ona(g);if(b){if(!this.zB){var d=this.$B("focusSkipLink"),h=this.kc,b=f.proxy(this.tK,this,!0);g=this.A("ariaFocusSkipLink");this.zB=new a.ei(h,g,b,d)}this.QH||(d=
this.$B("closeSkipLink"),h=this.element,b=f.proxy(this.aq,this),g=this.A("ariaCloseSkipLink"),this.QH=new a.ei(h,g,b,d))}},fV:function(){var a=this.GK;a&&(a.destroy(),delete this.GK);if(a=this.zB)a.destroy(),delete this.zB;if(a=this.QH)a.destroy(),delete this.QH},$B:function(b){var d=this.element.attr("id");a.Ea.Ni(d)&&(d=this.uuid);return[d,b].join("_")},Xq:function(){this.element.remove()},ut:function(){if(!this.Aj){var b=this.Aj={};b[a.N.Bc.bs]=f.proxy(this.aq,this);b[a.N.Bc.ds]=f.proxy(this.Xq,
this);b[a.N.Bc.jn]=f.proxy(this.refresh,this)}return this.Aj},aq:function(){this.bx=!0;this.close();delete this.bx}});a.Components.Tm({ojPopup:{modality:a.Components.nh(function(){return a.Ee.Yk("popup").modality})}})})()});