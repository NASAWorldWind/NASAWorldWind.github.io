/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/internal-deps/datagrid/DvtDataGrid","promise","ojs/ojcomponentcore","ojs/ojdatasource-common","ojs/ojarraydatagriddatasource","ojs/ojflattenedtreedatagriddatasource","ojs/ojpagingdatagriddatasource","ojs/ojinputnumber","ojs/ojmenu","ojs/ojdialog","ojs/ojpagingcontrol"],function(a,f,b){a.Yh=function(b,c){this.Aqa=b;this.bra=c;this.Qa={};this.Qa.datagrid="oj-datagrid";this.Qa.cell="oj-datagrid-cell";this.Qa.cellcontent="oj-datagrid-cell-content";this.Qa.celltext="oj-datagrid-cell-text";
this.Qa.banded="oj-datagrid-banded";this.Qa.row="oj-datagrid-row";this.Qa.databody="oj-datagrid-databody";this.Qa.topcorner="oj-datagrid-top-corner";this.Qa.bottomcorner="oj-datagrid-bottom-corner";this.Qa.rowheaderspacer="oj-datagrid-row-header-spacer";this.Qa.colheaderspacer="oj-datagrid-column-header-spacer";this.Qa.status="oj-datagrid-status";this.Qa.emptytext="oj-datagrid-empty-text";this.Qa.header="oj-datagrid-header";this.Qa.groupingcontainer="oj-datagrid-header-grouping";this.Qa.headercell=
"oj-datagrid-header-cell";this.Qa.headercelltext="oj-datagrid-header-cell-text";this.Qa.headercellcontent="oj-datagrid-header-cell-content";this.Qa.rowheader="oj-datagrid-row-header";this.Qa.colheader="oj-datagrid-column-header";this.Qa.colheadercell="oj-datagrid-column-header-cell";this.Qa.rowheadercell="oj-datagrid-row-header-cell";this.Qa["scroller-mobile"]="oj-datagrid-scroller-touch";this.Qa.scroller="oj-datagrid-scroller";this.Qa.scrollers="oj-datagrid-scrollers";this.Qa.focus="oj-focus";this.Qa.hover=
"oj-hover";this.Qa.active="oj-active";this.Qa.selected="oj-selected";this.Qa.disabled="oj-disabled";this.Qa.enabled="oj-enabled";this.Qa["default"]="oj-default";this.Qa.sortcontainer="oj-datagrid-sort-icon-container";this.Qa.sortascending="oj-datagrid-sort-ascending-icon";this.Qa.sortdescending="oj-datagrid-sort-descending-icon";this.Qa.icon="oj-component-icon";this.Qa.clickableicon="oj-clickable-icon-nocontext";this.Qa.info="oj-helper-hidden-accessible";this.Qa.rowexpander="oj-rowexpander";this.Qa.cut=
"oj-datagrid-cut";this.Qa.selectaffordancetop="oj-datagrid-touch-selection-affordance-top";this.Qa.selectaffordancebottom="oj-datagrid-touch-selection-affordance-bottom";this.Qa.toucharea="oj-datagrid-touch-area";this.Qa.draggable="oj-draggable";this.Qa.drag="oj-drag";this.Qa.drop="oj-drop";this.Qa.activedrop="oj-active-drop";this.Qa.validdrop="oj-valid-drop";this.Qa.invaliddrop="oj-invalid-drop";this.lh={};this.lh.sortCol="oj-datagrid-sortCol";this.lh.sortColAsc="oj-datagrid-sortColAsc";this.lh.sortColDsc=
"oj-datagrid-sortColDsc";this.lh.sortRow="oj-datagrid-sortRow";this.lh.sortRowAsc="oj-datagrid-sortRowAsc";this.lh.sortRowDsc="oj-datagrid-sortRowDsc";this.lh.resize="oj-datagrid-resize";this.lh.resizeWidth="oj-datagrid-resizeWidth";this.lh.resizeHeight="oj-datagrid-resizeHeight";this.lh.cut="oj-datagrid-cut";this.lh.paste="oj-datagrid-paste";this.lh.discontiguousSelection="oj-datagrid-discontiguousSelection";this.attributes={};this.attributes.key="data-oj-key";this.attributes.context="data-oj-context";
this.attributes.resizable="data-oj-resizable";this.attributes.sortable="data-oj-sortable";this.attributes.sortDir="data-oj-sortdir";this.attributes.expander="data-oj-expander";this.attributes.expanderIndex="data-oj-expander-index";this.attributes.container=a.Components.xn;this.attributes.extent="data-oj-extent";this.attributes.start="data-oj-start";this.attributes.depth="data-oj-depth";this.attributes.level="data-oj-level";this.attributes.tabMod="data-oj-tabmod"};o_("DataGridResources",a.Yh,a);a.Yh.prototype.l4=
function(){return"rtl"===this.Aqa?!0:!1};a.b.g("DataGridResources.prototype.isRTLMode",{l4:a.Yh.prototype.l4});a.Yh.prototype.M3=function(b,a){return this.bra(b,a)};a.b.g("DataGridResources.prototype.getTranslatedText",{M3:a.Yh.prototype.M3});a.Yh.prototype.RN=function(b){return null!=b?this.Qa[b]:null};a.b.g("DataGridResources.prototype.getMappedStyle",{RN:a.Yh.prototype.RN});a.Yh.prototype.kE=function(b){return null!=b?this.lh[b]:null};a.b.g("DataGridResources.prototype.getMappedCommand",{kE:a.Yh.prototype.kE});
a.Yh.prototype.QN=function(b){return null!=b?this.attributes[b]:null};a.b.g("DataGridResources.prototype.getMappedAttribute",{QN:a.Yh.prototype.QN});a.ya("oj.ojDataGrid",f.oj.baseComponent,{widgetEventPrefix:"oj",options:{bandingInterval:{row:0,column:0},data:null,gridlines:{horizontal:"visible",vertical:"visible"},scrollPosition:null,selectionMode:null,dnd:{reorder:{row:"disable"}},scrollPolicy:"auto",selection:[],currentCell:null,header:{row:{className:null,renderer:null,resizable:{width:"disable",
height:"disable"},sortable:"auto",style:null},column:{className:null,renderer:null,resizable:{width:"disable",height:"disable"},sortable:"auto",style:null}},cell:{className:null,renderer:null,style:null},resize:null,sort:null,optionChange:null,ready:null,scroll:null,beforeCurrentCell:null},_ComponentCreate:function(){this._super();this.root=this.element[0];this.qh=this.root.getAttribute("id");this.GU();this.S_();this.grid=new b;this.grid.setVisibility(b.VISIBILITY_STATE_RENDER);f(this.root).addClass("oj-datagrid oj-component");
this.XO={data:"all",header:["className","renderer","style","template"]}},rf:function(){this.Ok(this.root);f(this.root).empty();this._super();this.Gr=new a.Yh(this.dc(),this.cC.bind(this));this.l0();this.eu();null!=this.lc&&(this.zA(),this.grid.SetDataSource(this.lc));this.grid.SetOptions(this.options);this.grid.SetResources(this.Gr);this.grid.SetCreateContextCallback(this.via.bind(this));this.grid.SetRemoveCallback(this.rL.bind(this));this.grid.SetCreateReadyPromiseCallback(this.GU.bind(this));this.grid.SetResolveReadyPromiseCallback(this.S_.bind(this));
this.Rx();this.Cx();null!=this.lc&&this.Bj(this.root)},Rx:function(){var b=this;this.grid.addListener("resize",function(a){b._trigger("resize",a.event,a.ui)});this.grid.addListener("select",function(a){b.option("selection",a.ui.selection,{_context:{originalEvent:a.event,Wa:!0},changed:!0})});this.grid.addListener("currentCell",function(a){b.option("currentCell",a.ui,{_context:{originalEvent:a.event,Wa:!0},changed:!0})});this.grid.addListener("beforeCurrentCell",function(a){return b._trigger("beforeCurrentCell",
a.event,a.ui)});this.grid.addListener("sort",function(a){b._trigger("sort",a.event,a.ui)});this.grid.addListener("keydown",function(a){b._trigger("keydown",a.event,a.ui)});this.grid.addListener("ready",function(){b._trigger("ready",null,{})});this.grid.addListener("scroll",function(a){b._trigger("scroll",a.event,a.ui)})},refresh:function(){this._super();this.Ok(this.root);f(this.root).empty();!0===this.$ma&&(this.options.contextMenu=null);this.l0();null!=this.lc&&(this.lc instanceof a.bb&&(this.lc.Se(),
this.lc.Init()),this.zA(),this.grid.SetDataSource(this.lc));this.grid.SetOptions(this.options);this.grid.SetResources(this.Gr);this.grid.getVisibility()!=b.VISIBILITY_STATE_RENDER&&this.grid.setVisibility(b.VISIBILITY_STATE_REFRESH);this.Cx();null!=this.lc&&this.Bj(this.root)},_destroy:function(){null!=this.lc&&this.lc.Se&&this.lc.Se();this.grid.destroy();this.Ok(this.root);f(this.root).empty()},_setOptions:function(b,a){var e;this.lc?(e=this.Wla(b),this._super(b,a),e?this.refresh():this.grid.UpdateOptions(b)):
(this._super(b,a),null!=b.data&&this.refresh())},Al:function(){this._super();this.Cx()},zl:function(){this._super();this.grid.getVisibility()===b.VISIBILITY_STATE_VISIBLE&&this.grid.setVisibility(b.VISIBILITY_STATE_HIDDEN)},wn:function(){this._super();this.Cx()},oi:function(){this._super();this.grid.getVisibility()===b.VISIBILITY_STATE_VISIBLE&&this.grid.setVisibility(b.VISIBILITY_STATE_HIDDEN)},Wla:function(b){var c,e,g,f,k,l;g=!1;for(e in b)if(e in this.XO)if("data"===e){g=!0;break}else if("header"==
e)for(f in b.header){if("column"==f||"row"==f||"cell"==f)for(k in b.header[f]){for(c=0;c<this.XO.header.length;c++)if(k==this.XO.header[c])for(l in this.options.header[f])if(l==k&&b.header[f][k]!=this.options.header[f][k]){g=!0;break}if(g)break}if(g)break}else for(l in this.options)if(l==e&&!a.b.mh(b[e],this.options[l])){g=!0;break}return g},vC:function(b,a){return this.options.header[b]&&this.options.header[b].resizable?"disable"!==this.options.header[b].resizable[a]:!1},MY:function(b){return this.options.header[b]?
"disable"!==this.options.header[b].sortable:!1},zA:function(){var b,c,e=null,g=null,h=null,k=null,l,m;b=this;if(null==this.options.contextMenu){if(null!=this.lc){c=f("\x3cul\x3e");c.css("display","none").attr("id",this.qh+"contextmenu");f(this.root).append(c);if(this.vC("column","width")||this.vC("column","height")||this.vC("row","width")||this.vC("row","height"))e=this.ti("resize");l=this.lc.getCapability("sort");!this.MY("column")||"column"!==l&&"full"!==l||(g=this.ti("sortCol"));!this.MY("row")||
"row"!==l&&"full"!==l||(g=null!=g?g.add(this.ti("sortRow")):this.ti("sortRow"));if("enable"===this.options.dnd.reorder.row)switch(this.lc.getCapability("move")){case "none":break;default:k=this.lg("cut").add(this.lg("paste"))}this.wj()&&a.v.Ud()&&(this.hB=!1,h=this.lg("discontiguousSelection"));if(null!=e||null!=g||null!=k||null!=h)c.append(e).append(g).append(k).append(h),c.ojMenu(),this.$ma=!0,this._setOption("contextMenu","#"+c.attr("id")),c.on("ojselect",this.uj.bind(this))}}else null==this.MK&&
(this.MK=[]),c=f(this.options.contextMenu),e=c.find("[data-oj-command]"),m=[],e.each(function(){var a;a=f(this).children("a");if(0===a.length||-1!=b.MK.indexOf(a.get(0)))a=f(this).attr("data-oj-command").split("-"),a=b.ti(a[a.length-1]),f(this).replaceWith(a),m.push(a.children("a").get(0))}),this.MK=m,c.data("oj-ojMenu")&&c.ojMenu("refresh"),c.on("ojselect",this.uj.bind(this))},ti:function(b){if("resize"===b)return this.lg("resize").append(f("\x3cul\x3e\x3c/ul\x3e").append(this.lg("resizeWidth")).append(this.lg("resizeHeight")));
if("sortCol"===b)return this.lg("sortCol").append(f("\x3cul\x3e\x3c/ul\x3e").append(this.lg("sortColAsc")).append(this.lg("sortColDsc")));if("sortRow"===b)return this.lg("sortRow").append(f("\x3cul\x3e\x3c/ul\x3e").append(this.lg("sortRowAsc")).append(this.lg("sortRowDsc")));if(-1!=Object.keys(this.Gr.lh).indexOf(b))return f(this.lg(b))},lg:function(b){var a=f("\x3cli\x3e\x3c/li\x3e");a.attr("data-oj-command",this.Tl(b));a.append(this.nH(b));return a},nH:function(b){var a="label"+b.charAt(0).toUpperCase()+
b.slice(1);"discontiguousSelection"===b&&(a="labelEnableNonContiguous");return f('\x3ca href\x3d"#"\x3e\x3c/a\x3e').text(this.cC(a))},iW:function(){return f(this.options.contextMenu).get(0)},cC:function(b,a){return this.A(b,a)},pga:function(){var b=f("#"+this.qh+"spinner").ojInputNumber("option","value");f("#"+this.qh+"dialog").ojDialog("close");this.grid.handleContextMenuReturn(this.Bu,this.Sj,b);this.Bu.target.focus()},zaa:function(b,a){var e,g,h,k,l;e=f("#"+this.qh+"dialog");h=f("#"+this.qh+"spinner");
0===e.length||0===h.length?(e=f("\x3cdiv\x3e"),e.attr("id",this.qh+"dialog"),e.attr("title",b),g=f('\x3cdiv class\x3d"oj-dialog-body"\x3e\x3c/div\x3e'),k=f('\x3cdiv class\x3d"oj-dialog-footer"\x3e\x3c/div\x3e'),e.append(g).append(k),h=f('\x3cinput id\x3d"'+this.qh+'spinner"/\x3e'),l=f('\x3cbutton id\x3d"'+this.qh+'dialogsubmit"/\x3e'),g.append(h),k.append(l),f(this.root).append(e),l.ojButton({O:"ojButton",label:this.cC("labelResizeDialogSubmit")}),l.on("click",this.pga.bind(this)),h.ojInputNumber({O:"ojInputNumber",
max:1E3,min:20,step:1,value:a}),e.ojDialog({initialVisibility:"show",position:{my:"center center",at:"center center",collision:"none",of:f(this.root)}})):(h.ojInputNumber("option","value",a),f("#"+this.qh+"dialog").ojDialog("open"))},uj:function(b,a){var e;this.Sj=a.item.attr("data-oj-command");this.Sj===this.Tl("sortColAsc")||this.Sj===this.Tl("sortColDsc")||this.Sj===this.Tl("cut")||this.Sj===this.Tl("paste")?this.grid.handleContextMenuReturn(this.Bu,this.Sj,null):this.Sj===this.Tl("resizeWidth")||
this.Sj===this.Tl("resizeHeight")?(e=f(this.Bu.target).closest("."+this.Nd("cell")),0==e.length&&(e=f(this.Bu.target).closest("."+this.Nd("headercell"))),0<e.length&&(e=this.Sj===this.Tl("resizeWidth")?e.outerWidth():e.outerHeight(),this.zaa(a.item.text(),e))):this.Sj===this.Tl("discontiguousSelection")&&(this.hB=!this.hB,this.grid.handleContextMenuReturn(this.Bu,this.Sj,this.hB),e=this.hB?"labelDisableNonContiguous":"labelEnableNonContiguous",a.item.children().first().text(this.cC(e)))},uf:function(b,
a,e){this.grid.handleContextMenuGesture(a,e,this.tba.bind(this))},tba:function(b,a,e){var g;null!=b&&(this.Bu=a.originalEvent,g=b.launcher,b=b.capabilities,this.jia(b),g="keyboard"===e?{position:{of:g},launcher:f(g)}:{launcher:f(g)},this.wf(a,e,g))},x$:function(b){var a;a=f(this.iW());a.find("[data-oj-command\x3d"+b+"]").hasClass("oj-disabled")||a.find("[data-oj-command\x3d"+b+"]").addClass("oj-disabled")},fka:function(b){f(this.iW()).find("[data-oj-command\x3d"+b+"]").removeClass("oj-disabled")},
jia:function(b){var a,e;for(a in b)b.hasOwnProperty(a)&&(e=this.Gr.kE(a),"disable"===b[a]?this.x$(e):this.fka(e))},IV:function(b){var a;a=b.parent();b=b.index();return{rowIndex:a.index(),columnIndex:b}},Sra:function(b){var a;a=this.Rea().children().eq(0).children().eq(b.rowIndex+1);b=this.Nda().children().eq(0).children().eq(b.columnIndex);return{rowHeader:a,columnHeader:b}},qW:function(){return f(this.root)},Nda:function(){return f("#"+this.qh+"\\:columnHeader")},Rea:function(){return f("#"+this.qh+
"\\:rowHeader")},Tda:function(){return f("#"+this.qh+"\\:databody ."+this.Nd("row"))},l0:function(){this.lc=null!=this.options.data?this.options.data:null},eu:function(){var b=this.options.selection;null!=b&&this.grid.SetSelection(b)},via:function(b){b.component=a.Components.Tf(this.element,"ojDataGrid")},$C:function(b){this.grid.SetAccessibleContext(b)},Ok:function(b){b&&this.Le&&a.v.Si(b,this.Le)},Bj:function(b){b&&(null==this.Le&&(this.Le=this.af.bind(this)),a.v.Ph(b,this.Le))},af:function(b,a){0<
b&&0<a&&(this.Cx(),this.grid.HandleResize(b,a))},getNodeBySubId:function(b){var a,e,g,h;if(null==b)return this.element?this.element[0]:null;a=b.subId;if("oj-datagrid-cell"===a)a=b.rowIndex-this.grid.getStartRow(),b=b.columnIndex-this.grid.getStartColumn(),g=this.Tda().eq(a).children().eq(b);else if("oj-datagrid-sort-icon"===a||"oj-datagrid-sort-ascending"===a||"oj-datagrid-sort-descending"===a||"oj-datagrid-header"===a){h=b.axis;g=b.index;b=null==b.level?0:b.level;"column"===h?e=this.sW(g,b,f("#"+
this.qh+"\\:columnHeader"),this.grid.getStartColumnHeader()):"row"===h&&(e=this.sW(g,b,f("#"+this.qh+"\\:rowHeader"),this.grid.getStartRowHeader()));if(null==e)return null;if("oj-datagrid-sort-icon"===a)return e.children("."+this.Nd("sortcontainer")).children().get(0);g="oj-datagrid-sort-ascending"===a?e.find("."+this.Nd("sortascending")):"oj-datagrid-sort-descending"===a?e.find("."+this.Nd("sortdescending")):e}return null!=g&&0<g.length?g[0]:null},getSubIdByNode:function(b){var a,e;a=f(b).closest("."+
this.Nd("cell"));if(0<a.length)return b=this.IV(a),{subId:"oj-datagrid-cell",rowIndex:b.rowIndex+this.grid.getStartRow(),columnIndex:b.columnIndex+this.grid.getStartColumn()};e=f(b).closest("."+this.Nd("headercell"));return 0<e.length?(a=e[0][this.sj("context")],b=f(b).hasClass(this.Nd("sortascending"))?"oj-datagrid-sort-ascending":f(b).hasClass(this.Nd("sortdescending"))?"oj-datagrid-sort-descending":"oj-datagrid-header",{subId:b,axis:a.axis,index:this.tW(e),level:a.level}):null},getContextByNode:function(b){var a;
a=f(b).closest("."+this.Nd("cell"));if(0<a.length)return b=a[0][this.sj("context")],a=this.IV(a),{subId:"oj-datagrid-cell",component:b.component,data:b.data,datasource:b.datasource,indexes:{row:a.rowIndex+this.grid.getStartRow(),column:a.columnIndex+this.grid.getStartColumn()},keys:{row:b.keys.row,column:b.keys.column}};a=f(b).closest("."+this.Nd("headercell"));return 0<a.length?(b=a[0][this.sj("context")],{subId:"oj-datagrid-header",axis:b.axis,component:b.component,data:b.data,datasource:b.datasource,
depth:b.depth,extent:b.extent,index:this.tW(a),key:b.key,level:b.level}):null},Nd:function(b){return this.Gr.RN(b)},sj:function(b){return this.Gr.QN(b)},Tl:function(b){return this.Gr.kE(b)},xha:function(){return null!=this.root.offsetParent?!0:!1},Cx:function(){var a=this.grid.getVisibility();this.xha()?(a===b.VISIBILITY_STATE_RENDER?this.grid.render(this.root):a===b.VISIBILITY_STATE_REFRESH&&this.grid.refresh(this.root),this.grid.setVisibility(b.VISIBILITY_STATE_VISIBLE)):a===b.VISIBILITY_STATE_VISIBLE&&
this.grid.setVisibility(b.VISIBILITY_STATE_HIDDEN)},sW:function(b,a,e,g){if(0>a)return null;if(e.children().first().children().last().hasClass(this.Nd("headercell")))return e.children().first().children("."+this.Nd("headercell")).eq(b-g);e=this.rW(b,a,0,e.children().first().children());if(null==e)return null;if(a<=parseInt(e.attr(this.sj("level")),10)+parseInt(e.children().eq(0).attr(this.sj("depth")),10)-1)return e.children().eq(0);g=parseInt(e.attr(this.sj("start")),10);b=b-g+1;return e.children().eq(b)},
rW:function(b,a,e,g){var f,k,l,m;if(null==g.eq(1)||g.eq(1).hasClass(this.Nd("headercell")))return a===e?g.eq(0).parent():null;f=g.parent().parent();for(l=f.hasClass(this.Nd("colheader"))||f.hasClass(this.Nd("rowheader"))?0:1;l<g.length;l++)if(f=parseInt(g.eq(l).attr(this.sj("start")),10),k=parseInt(g.eq(l).attr(this.sj("extent")),10),m=parseInt(g.eq(l).children().eq(0).attr(this.sj("depth")),10),b>=f&&b<f+k)return a<e+m?g.eq(l):this.rW(b,a,e+m,g.eq(l).children());return null},tW:function(b){var a;
if(b.parent().hasClass(this.Nd("groupingcontainer"))){a=parseInt(b.parent().attr(this.sj("start")),10);if(b.get(0)===b.parent().children(":first").get(0))return a;a--}else a=b.hasClass(this.Nd("rowheadercell"))?this.grid.getStartRowHeader():this.grid.getStartColumnHeader();return a+=b.index()},Xra:function(b){var a;return b.parent().hasClass(this.Nd("groupingcontainer"))?(a=parseInt(b.parent().attr(this.sj("level")),10),b.get(0)===b.parent().children(":first").get(0)?a:a+1):0},wj:function(){return null==
this.options.selectionMode||"multiple"!==this.options.selectionMode.row&&"multiple"!==this.options.selectionMode.cell?!1:!0},rL:function(b){f(b).remove()},scrollTo:function(b){this.grid.scroll(b)},whenReady:function(){return this.Gja},GU:function(){var b=this;this.Gja=new Promise(function(a){b.Hja=a})},S_:function(){this.Hja(null)}})});