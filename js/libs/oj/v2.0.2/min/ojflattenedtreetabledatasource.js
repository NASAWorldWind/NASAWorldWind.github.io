/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","ojs/ojdatasource-common"],function(a){a.hb=function(f,b){b=b||{};if(!(f instanceof a.ca))throw Error(a.T.fc._ERR_DATA_INVALID_TYPE_SUMMARY+"\n"+a.T.fc._ERR_DATA_INVALID_TYPE_DETAIL);this.i=f;this.kd=[];this.$=0;this.po=[];null==this.i.Jy("fetchSize")&&(this.i.MN=function(){return-1});var d=this;this.i.rE=function(b,e,f){var h,k,l,m=[],n=[],p=[];for(e=0;e<f.R();e++)h=f.getData(e),l=f.getMetadata(e).key,k=b+e,d.po[k]={},d.po[k].nodeSet=f,d.po[k].startIndex=b,m.push(h),
n.push(l),p.push(k),d.na.data.splice(k,0,h),d.na.keys.splice(k,0,l),d.na.indexes.splice(k,0,k);d.Ja||a.T.r.handleEvent.call(d,a.T.D.ADD,{data:m,keys:n,indexes:p});d.Lx();d.Ja&&setTimeout(function(){d.i.refresh();d.na=null;d.fetch()},0)};this.i.QE=function(b){var e,f,h=[],k=[],l=[];for(e=0;e<b.length;e++)f=b[e].index-e,h.push(""),k.push(""),l.push(f),d.na.data.splice(f,1),d.na.keys.splice(f,1),d.na.indexes.splice(f,1);d.Ja||a.T.r.handleEvent.call(d,a.T.D.REMOVE,{data:h,keys:k,indexes:l});d.Lx();d.Ja&&
setTimeout(function(){d.i.refresh();d.na=null;d.fetch()},0)};this.Init();if(null!=b&&("enabled"==b.startFetch||null==b.startFetch)||null==b)this.by=!0};o_("FlattenedTreeTableDataSource",a.hb,a);a.b.ga(a.hb,a.T,"oj.FlattenedTreeTableDataSource");a.hb.prototype.Init=function(){a.hb.r.Init.call(this)};a.b.g("FlattenedTreeTableDataSource.prototype.Init",{Init:a.hb.prototype.Init});a.hb.prototype.getCapability=function(){return"full"};a.b.g("FlattenedTreeTableDataSource.prototype.getCapability",{getCapability:a.hb.prototype.getCapability});
a.hb.prototype.getWrappedDataSource=function(){return this.i};a.b.g("FlattenedTreeTableDataSource.prototype.getWrappedDataSource",{getWrappedDataSource:a.hb.prototype.getWrappedDataSource});a.hb.prototype.fetch=function(a){a=a||{};return"init"!=a.fetchType||this.by?this.Ie(a):Promise.resolve()};a.b.g("FlattenedTreeTableDataSource.prototype.fetch",{fetch:a.hb.prototype.fetch});a.hb.prototype.at=function(a){var b;b=0>a||a>=this.na.length?null:{data:this.na.data[a],index:a,key:this.na.keys[a]};return new Promise(function(a){a(b)})};
a.b.g("FlattenedTreeTableDataSource.prototype.at",{at:a.hb.prototype.at});a.hb.prototype.collapse=function(a){this.i.collapse(a)};a.b.g("FlattenedTreeTableDataSource.prototype.collapse",{collapse:a.hb.prototype.collapse});a.hb.prototype.expand=function(a){this.i.expand(a)};a.b.g("FlattenedTreeTableDataSource.prototype.expand",{expand:a.hb.prototype.expand});a.hb.prototype.get=function(){a.l.Yb();return null};a.b.g("FlattenedTreeTableDataSource.prototype.get",{get:a.hb.prototype.get});a.hb.prototype.on=
function(f,b){if("expand"==f||"collapse"==f)this.i.on(f,b);else a.hb.r.on.call(this,f,b)};a.b.g("FlattenedTreeTableDataSource.prototype.on",{on:a.hb.prototype.on});a.hb.prototype.off=function(f,b){"expand"==f||"collapse"==f?this.i.off(f,b):a.hb.r.off.call(this,f,b)};a.b.g("FlattenedTreeTableDataSource.prototype.off",{off:a.hb.prototype.off});a.hb.prototype.sort=function(f){if(null==f)return Promise.resolve();var b=this;f.axis="column";return new Promise(function(d,c){b.i.getWrappedDataSource().sort(f,
{success:function(){setTimeout(function(){b.i.refresh();b.na=null;var c={header:f.key,direction:f.direction};a.T.r.handleEvent.call(b,a.T.D.SORT,c);d(c)},0)}.bind(this),error:function(a){c(a)}.bind(this)})})};a.b.g("FlattenedTreeTableDataSource.prototype.sort",{sort:a.hb.prototype.sort});a.hb.prototype.totalSize=function(){return-1};a.b.g("FlattenedTreeTableDataSource.prototype.totalSize",{totalSize:a.hb.prototype.totalSize});a.hb.prototype.totalSizeConfidence=function(){return"unknown"};a.b.g("FlattenedTreeTableDataSource.prototype.totalSizeConfidence",
{totalSizeConfidence:a.hb.prototype.totalSizeConfidence});a.hb.prototype.Qw=function(a){return this.po[a].nodeSet.getMetadata(a-this.po[a].startIndex)};a.hb.prototype.Ie=function(f){f=f||{};this.ay(f);this.$=null==f.startIndex?this.$:f.startIndex;var b=Number.MAX_VALUE;this.Ja=null==f.pageSize?this.Ja:f.pageSize;null!=this.Ja&&(b=this.Ja);var d=this.$;if(null!=this.na)if(null!=this.Ja){var c=this.na.data.length-1;if(this.$+this.Ja-1<=c){var c=a.hb.LB(this.na,this.$,this.Ja),b=[],e=[],g;for(g=this.$;g<=
c;g++)b[g-this.$]=this.na.data[g],e[g-this.$]=this.Qw(g).key;c={data:b,keys:e,startIndex:this.$};this.nj(f,c,null);return Promise.resolve(c)}this.$<=c&&(d=c+1)}else this.i.refresh(),this.na=null;else d=0;var h={start:d,count:b},k=this;return new Promise(function(b,c){k.i.No(h,{success:function(c){k.SJ(c,d);f.refresh=!0;c=a.hb.LB(k.na,k.$,k.Ja);var e=[],g=[],h;for(h=k.$;h<=c;h++)e[h-k.$]=k.na.data[h],g[h-k.$]=k.Qw(h).key;c={data:e,keys:g,startIndex:k.$};k.nj(f,c,null);b(c)}.bind(this),error:function(a){k.nj(f,
null,a);c(a)}.bind(this)})})};a.hb.prototype.SJ=function(f,b){var d,c;for(d=0;d<f.R();d++)c=b+d,this.po[c]={},this.po[c].nodeSet=f,this.po[c].startIndex=b;this.na||(this.na={},this.na.data=[],this.na.keys=[],this.na.indexes=[]);a.hb.wt(f,this,this.na)};a.hb.prototype.ay=function(f){f.silent||a.T.r.handleEvent.call(this,a.T.D.REQUEST,{startIndex:f.startIndex})};a.hb.prototype.nj=function(f,b,d){null!=d?a.T.r.handleEvent.call(this,a.T.D.ERROR,d):f.silent||a.T.r.handleEvent.call(this,a.T.D.SYNC,b)};
a.hb.LB=function(a,b,d){var c=a.data.length-1;0<d&&(c=b+d-1,c=c>a.data.length-1?a.data.length-1:c);return c};a.hb.wt=function(a,b,d){b=a.R()-1;var c;for(c=a.ta();c<=b;c++){var e=a.getData(c);d.data[c]=e;d.keys[c]="";d.indexes[c]=c}};a.hb.prototype.Lx=function(){for(var a=0;a<this.na.data.length;a++)this.na.indexes[a]=a}});