/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","ojs/ojdatasource-common"],function(a){a.bc=function(){};o_("PagingModel",a.bc,a);a.bc.prototype.getPage=function(){};a.b.g("PagingModel.prototype.getPage",{getPage:a.bc.prototype.getPage});a.bc.prototype.setPage=function(){};a.b.g("PagingModel.prototype.setPage",{setPage:a.bc.prototype.setPage});a.bc.prototype.getStartItemIndex=function(){};a.b.g("PagingModel.prototype.getStartItemIndex",{getStartItemIndex:a.bc.prototype.getStartItemIndex});a.bc.prototype.getEndItemIndex=
function(){};a.b.g("PagingModel.prototype.getEndItemIndex",{getEndItemIndex:a.bc.prototype.getEndItemIndex});a.bc.prototype.getPageCount=function(){};a.b.g("PagingModel.prototype.getPageCount",{getPageCount:a.bc.prototype.getPageCount});a.bc.prototype.totalSize=function(){};a.b.g("PagingModel.prototype.totalSize",{totalSize:a.bc.prototype.totalSize});a.bc.prototype.totalSizeConfidence=function(){};a.b.g("PagingModel.prototype.totalSizeConfidence",{totalSizeConfidence:a.bc.prototype.totalSizeConfidence});
a.bc.D={BEFOREPAGE:"beforePage",PAGE:"page",PAGECOUNT:"pageCount"};o_("PagingModel.EventType",a.bc.D,a);a.la=function(f){if(!(f instanceof a.T))throw Error(a.T.fc._ERR_DATA_INVALID_TYPE_SUMMARY+"\n"+a.T.fc._ERR_DATA_INVALID_TYPE_DETAIL);this.uc=f;this.$=0;this.wi=-1;this.Init()};o_("PagingTableDataSource",a.la,a);a.b.ga(a.la,a.T,"oj.PagingTableDataSource");a.la.prototype.Init=function(){a.la.r.Init.call(this)};a.b.g("PagingTableDataSource.prototype.Init",{Init:a.la.prototype.Init});a.la.prototype.getWrappedDataSource=
function(){return this.uc};a.b.g("PagingTableDataSource.prototype.getWrappedDataSource",{getWrappedDataSource:a.la.prototype.getWrappedDataSource});a.la.prototype.getPage=function(){return"loadMore"==this.rB?0:this.UB()};a.b.g("PagingTableDataSource.prototype.getPage",{getPage:a.la.prototype.getPage});a.la.prototype.setPage=function(f,b){b=b||{};f=parseInt(f,10);try{a.la.r.handleEvent.call(this,a.bc.D.BEFOREPAGE,{page:f,previousPage:this.UB()})}catch(d){return Promise.reject(null)}var c=this.UB();
this.Ja=null!=b.pageSize?b.pageSize:this.Ja;b.pageSize=this.Ja;b.startIndex=f*this.Ja;this.$=null==b.startIndex?this.$:b.startIndex;this.rB="page";var e=this;return new Promise(function(d,f){0<e.Ja?e.uc.fetch(b).then(function(b){b.startIndex=0;e.CD(b.data.length);a.la.r.handleEvent.call(e,a.bc.D.PAGE,{page:e.UB(),previousPage:c});d(null)},function(){e.$=c*e.Ja;f(null)}):d(null)})};a.b.g("PagingTableDataSource.prototype.setPage",{setPage:a.la.prototype.setPage});a.la.prototype.getStartItemIndex=function(){return"loadMore"==
this.rB?0:this.$};a.b.g("PagingTableDataSource.prototype.getStartItemIndex",{getStartItemIndex:a.la.prototype.getStartItemIndex});a.la.prototype.getEndItemIndex=function(){return this.wi};a.b.g("PagingTableDataSource.prototype.getEndItemIndex",{getEndItemIndex:a.la.prototype.getEndItemIndex});a.la.prototype.getPageCount=function(){var a=this.totalSize();return-1==a?-1:Math.ceil(a/this.Ja)};a.b.g("PagingTableDataSource.prototype.getPageCount",{getPageCount:a.la.prototype.getPageCount});a.la.prototype.at=
function(a,b){return this.uc.at(a,b)};a.b.g("PagingTableDataSource.prototype.at",{at:a.la.prototype.at});a.la.prototype.fetch=function(a){a=a||{};if(null==a.startIndex)return this.setPage(this.getPage());this.rB="loadMore";this.$=null==a.startIndex?this.$:a.startIndex;var b=null!=a.pageSize?a.pageSize:this.Ja;a.pageSize=b;a.startIndex=this.$;var d=this;return new Promise(function(c,e){0<b?d.uc.fetch(a).then(function(a){d.CD(a.data.length);c(a)},function(a){e(a)}):c(null)})};a.b.g("PagingTableDataSource.prototype.fetch",
{fetch:a.la.prototype.fetch});a.la.prototype.get=function(a,b){return this.uc.get(a,b)};a.b.g("PagingTableDataSource.prototype.get",{get:a.la.prototype.get});a.la.prototype.getCapability=function(a){return this.uc.getCapability(a)};a.b.g("PagingTableDataSource.prototype.getCapability",{getCapability:a.la.prototype.getCapability});a.la.prototype.on=function(f,b){var d=this,c=this.uc;if(f==a.T.D.SYNC){var e=function(a){d.wga(a,b)};c.on(f,e);return e}if(f==a.T.D.ADD||f==a.T.D.REMOVE||f==a.T.D.CHANGE)return e=
function(a){d.qga(a,b)},c.on(f,e),e;if(f==a.T.D.REFRESH||f==a.T.D.RESET)return e=function(a){d.$=0;b(a)},c.on(f,e),e;if(f==a.bc.D.PAGE||f==a.bc.D.PAGECOUNT)a.la.r.on.call(this,f,b);else c.on(f,b);return b};a.b.g("PagingTableDataSource.prototype.on",{on:a.la.prototype.on});a.la.prototype.off=function(f,b){return f==a.bc.D.PAGE||f==a.bc.D.PAGECOUNT?(a.la.r.off.call(this,f,b),b):this.uc.off(f,b)};a.b.g("PagingTableDataSource.prototype.off",{off:a.la.prototype.off});a.la.prototype.sort=function(a){return this.uc.sort(a)};
a.b.g("PagingTableDataSource.prototype.sort",{sort:a.la.prototype.sort});a.la.prototype.totalSize=function(){return this.uc.totalSize()};a.b.g("PagingTableDataSource.prototype.totalSize",{totalSize:a.la.prototype.totalSize});a.la.prototype.totalSizeConfidence=function(){return this.uc.totalSizeConfidence()};a.b.g("PagingTableDataSource.prototype.totalSizeConfidence",{totalSizeConfidence:a.la.prototype.totalSizeConfidence});a.la.prototype.UB=function(){return 0<this.Ja?Math.floor(this.$/this.Ja):0};
a.la.prototype.qga=function(a,b){var d=[],c;for(c=0;c<a.indexes.length;c++){var e=a.indexes[c];void 0!==e&&(e-=this.$,(0>e||e>=this.$+this.Ja)&&d.push(c))}if(0<d.length)for(d.sort(function(a,b){return a-b}),c=d.length-1;0<=c;c--)a.data.splice(d[c],1),a.indexes.splice(d[c],1),a.keys.splice(d[c],1);this.CD(a.data.length);a.startIndex=this.$;b(a)};a.la.prototype.wga=function(f,b){f.startIndex!=this.$&&(this.$=f.startIndex);this.CD(f.data.length);if("page"==this.rB){var d={};a.zc.Lf(d,f);d.startIndex=
0;b(d)}else b(f)};a.la.prototype.CD=function(a){var b=this.totalSize();0<b?(this.wi=this.$+this.Ja-1,this.wi=this.wi>b-1?b-1:this.wi):this.wi=0<a?this.$+a-1:-1};a.la.D={ADD:"add",REMOVE:"remove",RESET:"reset",SYNC:"sync",REFRESH:"refresh",SORT:"sort"};o_("PagingTableDataSource.EventType",a.la.D,a)});