/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery"],function(a,f){a.dg=function(a,d,c){c=c||{};this.i=d;this.nB=a;this.ht=c.fetchSize;this.ht=0<this.ht?this.ht:25;this.St=c.maxCount;this.St=0<this.St?this.St:500;this.ZC=0;this.c1=c.success;this.ada=c.error;this.Oq();f(this.nB).on("scroll.domscroller",function(a){var b=f(a.target).scrollTop();a=f(a.target)[0].scrollHeight-f(a.target)[0].clientHeight;0<a&&this.$J(b,a)}.bind(this))};a.dg.prototype.destroy=function(){this.Nk();f(this.nB).off("scroll.domscroller")};a.b.g("DomScroller.prototype.destroy",
{destroy:a.dg.prototype.destroy});a.dg.prototype.checkViewport=function(){return 0<this.nB[0].clientHeight&&!this.Taa()?this.FV():Promise.resolve(null)};a.b.g("DomScroller.prototype.checkViewport",{checkViewport:a.dg.prototype.checkViewport});a.dg.prototype.$J=function(a,d){if(1>=d-a){var c=this;this.FV().then(function(a){null!=c.c1&&c.c1(a)},this.ada)}};a.dg.prototype.Taa=function(){var a=this.nB;return a[0].scrollHeight>a[0].clientHeight+1?!0:!1};a.dg.prototype.FV=function(){if(this.qB)return this.qB;
var a=this.St-this.ZC;if(0<a){var d=this.ht,c=this;a<this.ht&&(d=a);var e=this.kda({pageSize:d});return this.qB=new Promise(function(d){e.then(function(e){c.qB=null;null!=e&&(c.ZC=e.data.length+e.startIndex,a<c.ht&&(e.maxCount=c.St,e.maxCountLimit=!0));d(e)})})}return Promise.resolve({maxCount:this.St,maxCountLimit:!0})};a.dg.prototype.kda=function(a){a=a||{};var d=a.pageSize;this.Fh=this.Fh?this.Fh+d:d;if(-1==this.i.totalSize()||this.i.totalSize()>this.Fh){var c=this;return new Promise(function(a,
b){c.i.fetch({startIndex:c.Fh,pageSize:d}).then(function(b){a(b)},function(){b(null)})})}return Promise.resolve()};a.dg.prototype.ao=function(){this.Fh=null;this.ZC=0};a.dg.prototype.Bfa=function(a){this.Fh=a.startIndex;this.ZC=a.data.length+this.Fh};a.dg.prototype.Oq=function(){var b=this.i;if(null!=b){this.Nk();this.Va=[];this.Va.push({eventType:a.T.D.SORT,eventHandler:this.ao.bind(this)});this.Va.push({eventType:a.T.D.REFRESH,eventHandler:this.ao.bind(this)});this.Va.push({eventType:a.T.D.RESET,
eventHandler:this.ao.bind(this)});this.Va.push({eventType:a.T.D.SYNC,eventHandler:this.Bfa.bind(this)});var d,c;for(d=0;d<this.Va.length;d++)(c=b.on(this.Va[d].eventType,this.Va[d].eventHandler))&&(this.Va[d].eventHandler=c)}};a.dg.prototype.Nk=function(){var a=this.i;if(null!=this.Va&&null!=a){var d;for(d=0;d<this.Va.length;d++)a.off(this.Va[d].eventType,this.Va[d].eventHandler)}}});